# 리팩토링이란 무엇인가?

## Clean Code
#### 리팩토링을 하는 주 목적은 기술 부채와 싸우기 위함입니다. 리팩토링은 엉망인 코드를 클린한 코드로, 심플한 디자인으로 변화시킵니다. 
#### 좋지 않나요? 그럼 클린 코드가 뭘까요? 
#### 여기 클린 코드에 대한 몇 가지 특성이 있습니다.

### 1. 클린 코드는 다른 프로그래머들에게 명백합니다.
- 저는 지금 엄청 정교한 알고리즘에 대해 이야기하고 있는게 아닙니다. 당신이 만들어낸 몹쓸 변수명, 너무 커진 클래스들과 함수, 알 수 없는 숫자들은 코드에 뛰어들기에 어렵고 질척거리게 만듭니다.

### 2. 클린 코드는 중복을 포함하지 않습니다. 
- 중복된 코드들을 수정하려고 시도할 때마다 모든 인스턴스들을 동일하게 변경해야 합니다. 이런 점은 인지 부하가 증가시키고 진행 속도를 느리게 합니다.

### 3. 클린 코드는 최소 개수의 클래스들과 기타 부분들이 포함되어 있습니다.
- 코드가 적을 수록 알고 있어야 하는 부분이 적어집니다. 코드가 적을수록 유지 관리가 용이해지고, 코드가 적을수록 버그가 줄어듭니다. 
- 코드는 책임입니다. 간단하고 단순하게 유지하십시오.

### 4. 클린 코드는 모든 테스트를 통과합니다.
- 여러분은 코드가 더러울 때, 테스트가 95%만 통과한다는 점을 알고있습니다. 커버리지가 0퍼센트라면 망했다는 걸 아실겁니다.

### 5. 클린 코드는 유지보수하기에 더 가볍고 쉽습니다.

## Technical Debt
#### 모든 사람들은 처음부터 훌륭한 코드를 쓰기위해 최선을 다합니다. 아마 프로젝트를 망치기 위해 의도적으로 더러운 코드를 짜는 프로그래머는 없을 것 입니다. 
#### 그렇다면 어떤 시점에서 코드가 더러워지는 걸까요?
#### 더러운 코드에 대한 **기술 부채**는 워드 커닝험에 의해 제안되었습니다.
#### 은행에서 융자를 받으면 더 빠르게 물건을 구입할 수 있습니다. 구매 과정을 빠르게 하기 위해 추가 비용을 지불하죠.
#### 당신은 원금을 갚을 뿐만 아니라, 추가 비용에 대한 이자도 지불합니다. 더 말할 필요도 없이, 이는 이자의 양이 수입을 초과하여 완전히 상환하는 것을 불가능하게 만들 수도 있습니다.

### 기술 부채의 원인
#### 1. 업무적 압박
- 때때로 업무의 순환은 완전히 기능을 끝내기 전에 일을 끝마칠 것을 강요합니다. 이런 경우 패치와 클러치가 코드에 나타나 프로젝트의 완료되지 않은 부분을 숨깁니다.

#### 2. 기술 부채 결과에 대한 이해의 부족
- 때때로 고용주는 기술 부채가 축적됨에 따라 발전 속도를 늦추는 "이자"가 있다는 것을 이해하지 못할 수 있습니다. 
- 이는 경영진이 리팩토링의 가치를 이해하지 못했기 때문에, 팀의 시간을 리팩토링에 할애하기 어렵게 만들 수 있습니다.

#### 3. 구성 요소의 엄격한 일관성에 대처하지 못함
- 각 모듈의 산물이라기보다 모놀리스와 닮은 프로젝트이다. 이 경우엔, 프로젝트의 한 변경사항이 다른 부분에 영향을 끼칩니다.
- 각 개인의 업무 분리가 어려워져 팀의 발전이 더 어려워집니다. 

#### 4. 테스트의 부재
- 즉각적인 피드백이 부족하면, 신속하고 위험한 해결 방법이나 난관이 발생할 수 있습니다.
- 최악의 경우, 이런 변경 사항이 구현되자마자 테스트없이 프로덕션으로 배포됩니다. 이 결과는 매우 치명적일 수 있습니다.
- 예를 들어, 결점이 없는 핫픽스는 수천의 고객에게 이상한 테스트 전자메일을 보내거나 전체 데이터베이스를 플러시하는 손상을 시킬 수 있습니다.

#### 5. 문서의 부재
- 이는 만약 주요한 사람이 프로젝트를 그만두게 되었을 때, 새로운 사람이 프로젝트에 들어오는 것을 늦추고 개발을 주저하게 만들 수 있습니다. 

#### 6. 팀원들간의 상호 교류의 부재
- 만약 지식이 회사 전체에 배포되지 않는다면, 사람들은 그 프로젝트에 대한 프로세스와 정보가 뒤떨어진 상태로 일을 해야 합니다.
- 이런 상황은 후배 개발자들이 그들의 멘토들에 의해 잘못 훈련될 때, 악화될 수 있습니다.

#### 7. 몇개의 브랜치들의 장기간 지속되는 개발
- 이는 기술 부채가 누적될 수 있으며, 이후 변경 사항이 병합될 때 부채가 더 증가하게 됩니다. 
- 고립된 상황에서 변화가 많을 수록 기술 부채는 더 커지게 됩니다.

#### 8. 리팩토링의 지연
- 프로젝트의 요구사항은 끊임없이 변화하고 있으며, 어떤 시점에서는 코드의 일부가 쓸모없고 번거로워지며 새 요구사항을 충족하기 위해 재설계되어야 함이 명백해집니다.
- 반면, 이 프로젝트의 프로그래머들은 쓸모없는 부품들과 함께 작동되는 새로운 코드들을 매일 쓰고 있습니다. 
- 따라서, 리팩토링이 지연될 수록 향후 더 많은 종속 코드를 재작업해야합니다. 

#### 9. Compliance 모니터링의 부재
- 프로젝트를 작업하는 모든 사용자가 적합한 코드(이전에 작성한 방식과 동일한 코드)를 작성할 때 발생합니다.

#### 10. 무능함
- 개발자가 적절한 코드를 구현할 줄 모를 때 발생합니다.

## 리팩토링의 시기
### 세 가지 규칙
1. 처음에는 그냥 하세요. 
2. 비슷한 일을 두 번째로 하게 되면(중복이 생겼다는 사실이 당황스럽겠지만), 일단 계속 진행하세요.
3. 비슷한 일을 세 번째 하게 되면 리팩토링합니다.
> 야구를 좋아하는 사람은 **스트라이크 세 번이면 리팩토링하라**로 기억하세요.

### 기능을 추가할 때
- 리팩토링은 다른 사람의 코드를 이해하는 데 도움이 됩니다. 만약 당신이 다른 사람이 구현한 더러운 코드를 처리해야 한다면, 먼저 리팩토링해주세요. 클린 코드는 훨씬 파악하기 쉽고, 다른 사람이 사용하기에도 좋아집니다.
- 리팩토링을 하면 새 기능을 더 쉽게 추가할 수 있습니다. 클린 코드를 변경하는 것이 더 쉬운 작업입니다.

### 버그를 고칠 때
- 코드 속 버그는 실제 생활에서 버그와 똑같이 행동합니다. 버그는 코드안에 가장 어둡고 더러운 곳에서 삽니다. 코드를 깨끗이 하면, 오류가 저절로 발견됩니다.
- 관리자는 사전 예방적인 리팩토링이 나중에 특별한 리팩토링 작업이 필요하지 않으므로 이를 높게 평가합니다. 행복한 상사는 행복한 프로그래머를 만듭니다.

### 코드리뷰 동안에
- 코드 리뷰는 대중에게 공개되기 전에 코드를 정리할 수 있는 마지막 기회입니다.
- 그런 리뷰는 작가와 한 쌍으로 하는 것이 좋습니다. 이렇게 하면 간단한 문제를 신속하게 해결하고, 더 어려운 문제를 해결하기 위한 시간을 측정할 수 있습니다.

## 리팩토링 하는 방법
#### 리팩토링은 일련의 작은 변경으로 수행되어야 하며, 각 변경으로 기존 코드가 약간 개선되고 프로그램은 여전히 작동중인 상태로 유지되어야 합니다.
### 올바르게 리팩토링되기 위한 체크리스트
#### 1. 코드가 깨끗해져야 합니다.
- 리팩터링 후에도 코드가 똑같이 더러운 상태로 남아 있으면... 미안하지만, 당신은 인생의 한 시간을 낭비했습니다. 왜 이렇게 되었는지 알아내려 노력해보세요.
- 작은 변화들로 리팩터링을 하는 것에서 벗어나 많은 리팩터링을 하나의 큰 변화로 혼합할 때 이런 일이 종종 발생합니다. 이럴 때 정신을 잃기 쉬운데, 특히 시간 제한이 있다면 더욱 그렇습니다.
- 또 매우 엉성한 코드로 작업할 때에도 발생할 수 있습니다. 무엇을 개선하든 이런 코드는 전체적으로 재앙으로 남습니다.
- 이 경우 코드의 일부를 완전히 다시 작성하는 것에 대해 생각해 볼 가치가 있습니다. 그 전에 여러분은 많은 시간을 할애해야 하는데, 그렇지 않다면 처음 말한 결과를 얻게될 수 있습니다.

#### 리팩토링 중에는 새로은 기능을 작성하면 안됩니다.
- 새로운 기능을 구현하는 것과 리팩토링을 혼동하지 마세요. 적어도 개별 커밋의 범위내에서 이런 프로세스를 분리하려고 하셔야 합니다.
- 기능을 추가할 때는 **기능추가** 모자를 쓴다음 기존 코드는 절대 건드리지 않고, 기능만 추가하셔야 합니다.
- 리팩토링할 때는, **리팩토링** 모자를 쓴다음 기능 추가는 절대 하지 않고 오로지 코드 재구성에만 전념하셔야 합니다.

#### 기존의 모든 테스트는 리팩토링 후에 통과되어야 합니다.
- 리팩토링 후 테스트가 중단되는 경우는 두 가지 입니다.
- 리팩토링하는 동안 오류가 발생했습니다
  - 이 문제는 문제 없습니다. 계속하여 오류를 수정하세요.
- 테스트가 너무 낮은 수준이었습니다.
  - 이 경우, 테스트가 문제입니다. 검증 자체를 리팩토링하거나 완전히 새로운 상위 수준 검증 집합을 작성할 수 있습니다. 이런 상황을 피하는 가장 좋은 방법은 BDD 방식의 테스트를 작성하는 것입니다.









[GURU Link](https://refactoring.guru/refactoring/what-is-refactoring)
